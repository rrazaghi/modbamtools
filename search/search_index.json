{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Modbamtools Documentation modbamtools is a set of tools to manipulate and visualize DNA/RNA base modification data that are stored in bam format. htslib has included a support for parsing modified base tags from alignment files (MM and ML). These tags have provided a better/efficient way for storing modification data inside alignment files. For more information about these tags, please visit here . For a detailed tutorial of each command, please visit tutorial page . Generate modified base tags for your data modbamtools is technology agnostic. However, tools tailored for analysis of modified bases using long-read technology are currently adapting to using MM/ML tags at a much higher rate. Below are the list of tools that can generate these tags to be used with modbamtools: Oxford Nanopore Technology (ONT) Bonito Guppy Nanopolish Megalodon Remora Pacific Biosciences (Pacbio) Primrose ccsmeth Haplotypes modbamtools commands can parse information per haplotype based on the presence of HP tag in your modbam files. You can find some of the tools to generate this tag below: PEPPER WhatsHap Clair3 LongPhase Install Required : Python >=3.8 , <=3.10 In a clean environment: $ pip install modbamtools Commands modbamtools plot - Plot single-read base modification data along other optional tracks (gtf, bedgraph, bigwig). modbamtools calcMeth - Calculate methylation statistics for regions in a bed file. modbamtools cluster - Perform clustering based on modification state for regions in a bed file. modbamtools calcHet - Calculate heterogeneity of modified bases for regions in a bed file. modbamtools --help - Print help message and exit. How to cite modbamtools If you use modbamtools in your research please cite modbamtools preprint: https://www.biorxiv.org/content/10.1101/2022.07.07.499188v1 Acknowledgment We would like to thank Jared Simpson and Chris Wright for their helpful comments and contributions to the development of modified base alignment files.","title":"Home"},{"location":"#modbamtools-documentation","text":"modbamtools is a set of tools to manipulate and visualize DNA/RNA base modification data that are stored in bam format. htslib has included a support for parsing modified base tags from alignment files (MM and ML). These tags have provided a better/efficient way for storing modification data inside alignment files. For more information about these tags, please visit here . For a detailed tutorial of each command, please visit tutorial page .","title":"Modbamtools Documentation"},{"location":"#generate-modified-base-tags-for-your-data","text":"modbamtools is technology agnostic. However, tools tailored for analysis of modified bases using long-read technology are currently adapting to using MM/ML tags at a much higher rate. Below are the list of tools that can generate these tags to be used with modbamtools: Oxford Nanopore Technology (ONT) Bonito Guppy Nanopolish Megalodon Remora Pacific Biosciences (Pacbio) Primrose ccsmeth","title":"Generate modified base tags for your data"},{"location":"#haplotypes","text":"modbamtools commands can parse information per haplotype based on the presence of HP tag in your modbam files. You can find some of the tools to generate this tag below: PEPPER WhatsHap Clair3 LongPhase","title":"Haplotypes"},{"location":"#install","text":"Required : Python >=3.8 , <=3.10 In a clean environment: $ pip install modbamtools","title":"Install"},{"location":"#commands","text":"modbamtools plot - Plot single-read base modification data along other optional tracks (gtf, bedgraph, bigwig). modbamtools calcMeth - Calculate methylation statistics for regions in a bed file. modbamtools cluster - Perform clustering based on modification state for regions in a bed file. modbamtools calcHet - Calculate heterogeneity of modified bases for regions in a bed file. modbamtools --help - Print help message and exit.","title":"Commands"},{"location":"#how-to-cite-modbamtools","text":"If you use modbamtools in your research please cite modbamtools preprint: https://www.biorxiv.org/content/10.1101/2022.07.07.499188v1","title":"How to cite modbamtools"},{"location":"#acknowledgment","text":"We would like to thank Jared Simpson and Chris Wright for their helpful comments and contributions to the development of modified base alignment files.","title":"Acknowledgment"},{"location":"commands/","text":"modbamtools commands Usage: modbamtools [OPTIONS] COMMAND [ARGS]... A set of tools to manipulate and visualize data from base modification bam files Options: --version Show the version and exit. [default: False] --help Show this message and exit. [default: False] Commands: calcMeth Calculate methylation statistics for regions in a bed file cluster Calculate clustering statistics for regions in a bed file plot Plot single-read base modification data plot Usage: modbamtools plot [OPTIONS] BAMS... Plot single-read base modification data Options: -r, --region TEXT Region of interest. example: chr21:1-1000 -br, --batch PATH makes html/pdf report for all regions in the bed file -g, --gtf PATH makes gene tracks from sorted and tabix gtf files -b, --bed PATH makes tracks from sorted and tabix bed files. This will plot each interval as a rectangle (similar to gtf) -bw, --bigwig PATH makes a track from bigwig files -bd, --bedgraph PATH makes a track from bedgraph files -s, --samples TEXT sample names per each bam input -tr, --track-titles TEXT titles of tracks provided in order of gtf files, bed files, bigwig files, bedgraph files -hp, --hap reads will be grouped according to HP tag in bam (comma separated) -st, --strands reads will be grouped by strand in bam -o, --out PATH output path [required] -p, --prefix TEXT File name for output [default: modbamviz] -f, --fmt TEXT format of output file (png, html, svg, pdf) [default: html] -u, --can_prob FLOAT probability threshold for canonical bases [default: 0.5] -m, --mod_prob FLOAT probability threshold for modified bases [default: 0.5] -h, --height INTEGER height of plot in px. This is for fine tuning, the height is automatically calculated. -w, --width INTEGER width of plot in px -c, --cluster cluster the reads based on modification state --help Show this message and exit. calcMeth Usage: modbamtools calcMeth [OPTIONS] BAM Calculate methylation statistics for regions in a bed file Options: -b, --bed PATH bed file of regions -t, --threads INTEGER number of processes [default: 1] -a, --min_calls INTEGER filter out reads that have fewer number of modified base calls in region of interest [default: 5] -s, --min_cov FLOAT minimum percent coverage of a single read over region of interest [default: 80] -hp, --hap add stats for each haplotype separately to the output -o, --out PATH output path [required] --help Show this message and exit. cluster Usage: modbamtools cluster [OPTIONS] BAM Calculate clustering statistics for regions in a bed file Options: -b, --bed PATH bed file of regions to cluster -t, --threads INTEGER number of processes [default: 1] -o, --out PATH output path [required] --help Show this message and exit.","title":"Commands"},{"location":"commands/#modbamtools-commands","text":"Usage: modbamtools [OPTIONS] COMMAND [ARGS]... A set of tools to manipulate and visualize data from base modification bam files Options: --version Show the version and exit. [default: False] --help Show this message and exit. [default: False] Commands: calcMeth Calculate methylation statistics for regions in a bed file cluster Calculate clustering statistics for regions in a bed file plot Plot single-read base modification data","title":"modbamtools commands"},{"location":"commands/#_1","text":"","title":""},{"location":"commands/#plot","text":"Usage: modbamtools plot [OPTIONS] BAMS... Plot single-read base modification data Options: -r, --region TEXT Region of interest. example: chr21:1-1000 -br, --batch PATH makes html/pdf report for all regions in the bed file -g, --gtf PATH makes gene tracks from sorted and tabix gtf files -b, --bed PATH makes tracks from sorted and tabix bed files. This will plot each interval as a rectangle (similar to gtf) -bw, --bigwig PATH makes a track from bigwig files -bd, --bedgraph PATH makes a track from bedgraph files -s, --samples TEXT sample names per each bam input -tr, --track-titles TEXT titles of tracks provided in order of gtf files, bed files, bigwig files, bedgraph files -hp, --hap reads will be grouped according to HP tag in bam (comma separated) -st, --strands reads will be grouped by strand in bam -o, --out PATH output path [required] -p, --prefix TEXT File name for output [default: modbamviz] -f, --fmt TEXT format of output file (png, html, svg, pdf) [default: html] -u, --can_prob FLOAT probability threshold for canonical bases [default: 0.5] -m, --mod_prob FLOAT probability threshold for modified bases [default: 0.5] -h, --height INTEGER height of plot in px. This is for fine tuning, the height is automatically calculated. -w, --width INTEGER width of plot in px -c, --cluster cluster the reads based on modification state --help Show this message and exit.","title":"plot"},{"location":"commands/#_2","text":"","title":""},{"location":"commands/#calcmeth","text":"Usage: modbamtools calcMeth [OPTIONS] BAM Calculate methylation statistics for regions in a bed file Options: -b, --bed PATH bed file of regions -t, --threads INTEGER number of processes [default: 1] -a, --min_calls INTEGER filter out reads that have fewer number of modified base calls in region of interest [default: 5] -s, --min_cov FLOAT minimum percent coverage of a single read over region of interest [default: 80] -hp, --hap add stats for each haplotype separately to the output -o, --out PATH output path [required] --help Show this message and exit.","title":"calcMeth"},{"location":"commands/#_3","text":"","title":""},{"location":"commands/#cluster","text":"Usage: modbamtools cluster [OPTIONS] BAM Calculate clustering statistics for regions in a bed file Options: -b, --bed PATH bed file of regions to cluster -t, --threads INTEGER number of processes [default: 1] -o, --out PATH output path [required] --help Show this message and exit.","title":"cluster"},{"location":"tutorial/","text":"Tutorial For this tutorial we are going to use ultra-long nanopore data from GM12878 aligned to chromosome 20 only. The modbam was generated using megalodon and haplotype tags were assigned using PEPPER . Download Data You can download all the files needed to go through this tutorial here . After extractiong, you should have the following files: . \u251c\u2500\u2500 gencode.v38.annotation.sorted.gtf.gz \u251c\u2500\u2500 gencode.v38.annotation.sorted.gtf.gz.tbi \u251c\u2500\u2500 genes.bed \u251c\u2500\u2500 gm12878_H3K27ac_ENCFF798KYP.bigWig \u251c\u2500\u2500 gm12878_H3K4me1_ENCFF190RZM.bigWig \u251c\u2500\u2500 gm12878_ul_sup_megalodon_HP_chr20.bam \u251c\u2500\u2500 gm12878_ul_sup_megalodon_HP_chr20.bam.bai \u2514\u2500\u2500 promoters.bed Plotting Basic plot First let's start with plotting an imprinted region for GNAS gene: modbamtools plot -r chr20:58815000-58895000 \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --prefix gm12878_GNAS \\ --samples GM12878 \\ --track-titles Genes\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_GNAS Haplotype separation We can group the reads based on HP tag by using --hap option: modbamtools plot -r chr20:58815000-58895000 \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --hap \\ --prefix gm12878_GNAS \\ --samples GM12878 \\ --track-titles Genes\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_GNAS_hap Bigwig tracks Bigwig tracks can also be added to the plot with --bigwig : modbamtools plot -r chr20:58820000-58895000 \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --hap \\ --bigwig gm12878_H3K27ac_ENCFF798KYP.bigWig \\ --bigwig gm12878_H3K4me1_ENCFF190RZM.bigWig \\ --prefix gm12878_GNAS_hap_h3k27ac_h3k4me1 \\ --samples GM12878 \\ --track-titles Genes,H3K27ac,H3k4me1\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_GNAS_hap_h3k27ac_h3k4me1 Cluster plot We can use --cluster option to perform clustering on the go and group reads based on the assigned cluster. To show an example, we focus on gene FRG1EP (you can find unclustered plot here ). For more information about the clustering algorithm see section clustering below. modbamtools plot -r chr20:29460146-29507179 \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --cluster \\ --prefix gm12878_FRG1EP_cluster \\ --track-titles Genes\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_FRG1EP_cluster Multiple input regions (Bed) If we are interested in plotting multiple regions simultaneously, we can feed modbamtools a bed file. Output formats can either be html or pdf in a single report document. modbamtools plot --batch genes.bed \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --hap \\ --prefix gm12878_batch \\ --samples GM12878 \\ --track-titles Genes\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_batch Clustering modbamtools uses a hierarichal density-based spatial clustering of noisy data algorithm ( HDBSCAN ) to cluster reads based on their modification state. modbamtools cluster takes a bed file as input and appends each line with two columns : number of clusters found , and number of reads used for clustering after a quality control step It should be noted that modification calls are often noisy and sparse. Therefore extra care should be applied when clustering. Best way is to plot clustering results using `modbamtools plot --cluster` to make sure clustering algorithm fits the nature of your data Let's try it on our genes.bed file: modbamtools cluster --bed genes.bed \\ --threads 3 \\ --out genes_clustered.bed \\ gm12878_ul_sup_megalodon_HP_chr20.bam We can see from the output below that all 3 regions have 2 clusters. We can confirm this by using the plotting commands above. chr20 29460146 29507179 FRG1EP unprocessed_pseudogene ENSG00000282995.1 2 42 chr20 58818918 58850903 GNAS-AS1 lncRNA ENSG00000235590.7 2 30 chr20 63556085 63576239 HELZ2 protein_coding ENSG00000130589.16 2 37 This command is especially useful when trying to distinguish reads associated with tumors in a heterogenous sample. You can also feed multiple modbams to find differentially clustered reads between different samples! Regional methylation calculation modbamtools calcMeth will accept a bed file as input and append modification stats as extra columns to each region of interest. For each region, Average percent modification is calculated for each read that spans a minimum portion of the region (This can be tweaked by --min_cov . Default is 80%). Each read has to have at least 5 calls to be considered valid for analysis (This can also be changed with --min_calls ). Then, Average percent modifcation for the region is calculated using valid reads. The appended columns are outlined below: Average Percent Modification Standrad Deviation for Avg Percent Modification Coverage Let's try it on our promoters.bed file: modbamtools calcMeth --bed promoters.bed \\ --threads 3 \\ --out promoters_calcMeth.bed \\ gm12878_ul_sup_megalodon_HP_chr20.bam chr20 29496679 29498179 FRG1EP unprocessed_pseudogene ENSG00000282995.1 63.00634042910756 23.160648801539175 79 chr20 58850403 58851903 GNAS-AS1 lncRNA ENSG00000235590.7 58.26586037568643 30.18888731341584 48 chr20 63573739 63575239 HELZ2 protein_coding ENSG00000130589.16 36.52218479283339 8.51755978542393 44 Haplotype stats We can also output stats for each haplotype based on HP tag in the modbam with --hap . The added columns when this option is used are the following: Average Percent Modification Standrad Deviation for Avg Percent Modification Coverage Average Percent Modification (haplotype 1) Standrad Deviation for Avg Percent Modification (haplotype 1) Coverage (haplotype 1) Average Percent Modification (haplotype 2) Standrad Deviation for Avg Percent Modification (haplotype 2) Coverage (haplotype 2) modbamtools calcMeth --bed promoters.bed \\ --threads 3 \\ --hap \\ --out promoters_calcMeth_hap.bed \\ gm12878_ul_sup_megalodon_HP_chr20.bam chr20 29496679 29498179 FRG1EP unprocessed_pseudogene ENSG00000282995.1 63.00634042910756 23.160648801539175 79 44.27765063921806 18.419436878488273 36 80.732273703281 10.455159906458562 36 chr20 58850403 58851903 GNAS-AS1 lncRNA ENSG00000235590.7 58.26586037568643 30.18888731341584 48 26.62614126968194 6.853899031338103 22 86.90174211774595 5.326307202363974 20 chr20 63573739 63575239 HELZ2 protein_coding ENSG00000130589.16 36.52218479283339 8.51755978542393 44 38.93859253773206 8.05201039505814 16 35.09734468342445 8.949332073699683 25","title":"Tutorial"},{"location":"tutorial/#tutorial","text":"For this tutorial we are going to use ultra-long nanopore data from GM12878 aligned to chromosome 20 only. The modbam was generated using megalodon and haplotype tags were assigned using PEPPER .","title":"Tutorial"},{"location":"tutorial/#download-data","text":"You can download all the files needed to go through this tutorial here . After extractiong, you should have the following files: . \u251c\u2500\u2500 gencode.v38.annotation.sorted.gtf.gz \u251c\u2500\u2500 gencode.v38.annotation.sorted.gtf.gz.tbi \u251c\u2500\u2500 genes.bed \u251c\u2500\u2500 gm12878_H3K27ac_ENCFF798KYP.bigWig \u251c\u2500\u2500 gm12878_H3K4me1_ENCFF190RZM.bigWig \u251c\u2500\u2500 gm12878_ul_sup_megalodon_HP_chr20.bam \u251c\u2500\u2500 gm12878_ul_sup_megalodon_HP_chr20.bam.bai \u2514\u2500\u2500 promoters.bed","title":"Download Data"},{"location":"tutorial/#plotting","text":"","title":"Plotting"},{"location":"tutorial/#basic-plot","text":"First let's start with plotting an imprinted region for GNAS gene: modbamtools plot -r chr20:58815000-58895000 \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --prefix gm12878_GNAS \\ --samples GM12878 \\ --track-titles Genes\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_GNAS","title":"Basic plot"},{"location":"tutorial/#haplotype-separation","text":"We can group the reads based on HP tag by using --hap option: modbamtools plot -r chr20:58815000-58895000 \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --hap \\ --prefix gm12878_GNAS \\ --samples GM12878 \\ --track-titles Genes\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_GNAS_hap","title":"Haplotype separation"},{"location":"tutorial/#bigwig-tracks","text":"Bigwig tracks can also be added to the plot with --bigwig : modbamtools plot -r chr20:58820000-58895000 \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --hap \\ --bigwig gm12878_H3K27ac_ENCFF798KYP.bigWig \\ --bigwig gm12878_H3K4me1_ENCFF190RZM.bigWig \\ --prefix gm12878_GNAS_hap_h3k27ac_h3k4me1 \\ --samples GM12878 \\ --track-titles Genes,H3K27ac,H3k4me1\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_GNAS_hap_h3k27ac_h3k4me1","title":"Bigwig tracks"},{"location":"tutorial/#cluster-plot","text":"We can use --cluster option to perform clustering on the go and group reads based on the assigned cluster. To show an example, we focus on gene FRG1EP (you can find unclustered plot here ). For more information about the clustering algorithm see section clustering below. modbamtools plot -r chr20:29460146-29507179 \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --cluster \\ --prefix gm12878_FRG1EP_cluster \\ --track-titles Genes\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_FRG1EP_cluster","title":"Cluster plot"},{"location":"tutorial/#multiple-input-regions-bed","text":"If we are interested in plotting multiple regions simultaneously, we can feed modbamtools a bed file. Output formats can either be html or pdf in a single report document. modbamtools plot --batch genes.bed \\ --gtf gencode.v38.annotation.sorted.gtf.gz \\ --out . \\ --hap \\ --prefix gm12878_batch \\ --samples GM12878 \\ --track-titles Genes\\ gm12878_ul_sup_megalodon_HP_chr20.bam gm12878_batch","title":"Multiple input regions (Bed)"},{"location":"tutorial/#clustering","text":"modbamtools uses a hierarichal density-based spatial clustering of noisy data algorithm ( HDBSCAN ) to cluster reads based on their modification state. modbamtools cluster takes a bed file as input and appends each line with two columns : number of clusters found , and number of reads used for clustering after a quality control step It should be noted that modification calls are often noisy and sparse. Therefore extra care should be applied when clustering. Best way is to plot clustering results using `modbamtools plot --cluster` to make sure clustering algorithm fits the nature of your data Let's try it on our genes.bed file: modbamtools cluster --bed genes.bed \\ --threads 3 \\ --out genes_clustered.bed \\ gm12878_ul_sup_megalodon_HP_chr20.bam We can see from the output below that all 3 regions have 2 clusters. We can confirm this by using the plotting commands above. chr20 29460146 29507179 FRG1EP unprocessed_pseudogene ENSG00000282995.1 2 42 chr20 58818918 58850903 GNAS-AS1 lncRNA ENSG00000235590.7 2 30 chr20 63556085 63576239 HELZ2 protein_coding ENSG00000130589.16 2 37 This command is especially useful when trying to distinguish reads associated with tumors in a heterogenous sample. You can also feed multiple modbams to find differentially clustered reads between different samples!","title":"Clustering"},{"location":"tutorial/#regional-methylation-calculation","text":"modbamtools calcMeth will accept a bed file as input and append modification stats as extra columns to each region of interest. For each region, Average percent modification is calculated for each read that spans a minimum portion of the region (This can be tweaked by --min_cov . Default is 80%). Each read has to have at least 5 calls to be considered valid for analysis (This can also be changed with --min_calls ). Then, Average percent modifcation for the region is calculated using valid reads. The appended columns are outlined below: Average Percent Modification Standrad Deviation for Avg Percent Modification Coverage Let's try it on our promoters.bed file: modbamtools calcMeth --bed promoters.bed \\ --threads 3 \\ --out promoters_calcMeth.bed \\ gm12878_ul_sup_megalodon_HP_chr20.bam chr20 29496679 29498179 FRG1EP unprocessed_pseudogene ENSG00000282995.1 63.00634042910756 23.160648801539175 79 chr20 58850403 58851903 GNAS-AS1 lncRNA ENSG00000235590.7 58.26586037568643 30.18888731341584 48 chr20 63573739 63575239 HELZ2 protein_coding ENSG00000130589.16 36.52218479283339 8.51755978542393 44","title":"Regional methylation calculation"},{"location":"tutorial/#haplotype-stats","text":"We can also output stats for each haplotype based on HP tag in the modbam with --hap . The added columns when this option is used are the following: Average Percent Modification Standrad Deviation for Avg Percent Modification Coverage Average Percent Modification (haplotype 1) Standrad Deviation for Avg Percent Modification (haplotype 1) Coverage (haplotype 1) Average Percent Modification (haplotype 2) Standrad Deviation for Avg Percent Modification (haplotype 2) Coverage (haplotype 2) modbamtools calcMeth --bed promoters.bed \\ --threads 3 \\ --hap \\ --out promoters_calcMeth_hap.bed \\ gm12878_ul_sup_megalodon_HP_chr20.bam chr20 29496679 29498179 FRG1EP unprocessed_pseudogene ENSG00000282995.1 63.00634042910756 23.160648801539175 79 44.27765063921806 18.419436878488273 36 80.732273703281 10.455159906458562 36 chr20 58850403 58851903 GNAS-AS1 lncRNA ENSG00000235590.7 58.26586037568643 30.18888731341584 48 26.62614126968194 6.853899031338103 22 86.90174211774595 5.326307202363974 20 chr20 63573739 63575239 HELZ2 protein_coding ENSG00000130589.16 36.52218479283339 8.51755978542393 44 38.93859253773206 8.05201039505814 16 35.09734468342445 8.949332073699683 25","title":"Haplotype stats"}]}